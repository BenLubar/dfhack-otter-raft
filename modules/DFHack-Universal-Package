module DFHack-Universal-Package<$GroupName = "", $PackageName, $NormalizedVersion = "", $OutputPath, $FeedName = Universal>
{
    if $NormalizedVersion == ""
    {
        Get-Http https://proget.local.lubar.me/upack/$FeedName/packages?group=$GroupName&name=$PackageName
        (
            MaxResponseLength: 2147483647,
            ProxyRequest: false,
            ResponseBody => $PackageInfo
        );

        set $NormalizedVersion = $MapItem(%FromJson($PackageInfo), latestVersion);
    }

    if $GroupName != ""
    {
        set $GroupName = $GroupName/;
    }

    Ensure-Directory $WorkingDirectory;

    Download-Http https://proget.local.lubar.me/upack/$FeedName/download/$GroupName$PackageName/$NormalizedVersion?contentOnly=zip
    (
        FileName: $WorkingDirectory/$PackageName.zip,
        LogResponseBody: false,
        MaxResponseLength: 2147483647,
        ProxyRequest: false
    );

    Extract-ZipFile $WorkingDirectory/$PackageName.zip
    (
        Directory: $OutputPath,
        Overwrite: true
    );
}
